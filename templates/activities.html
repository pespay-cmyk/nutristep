{% extends "base.html" %}

{% block title %}Suivi des activitÃ©s - NutriStep{% endblock %}

{% block content %}

<style>
    /* RESPONSIVE MOBILE pour Activities */
    @media (max-width: 768px) {
        h1 {
            font-size: 24px !important;
        }

        .card h2 {
            font-size: 18px !important;
        }

        form > div {
            grid-template-columns: 1fr !important;
        }

        table {
            font-size: 12px;
        }

        table th, table td {
            padding: 8px 6px;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .stat-card .value {
            font-size: 28px;
        }

        .stat-card h3 {
            font-size: 11px;
        }
    }
</style>

<h1 style="margin-bottom: 30px; color: var(--text-primary); font-size: 32px; font-weight: 700;">ğŸƒ Suivi des activitÃ©s</h1>

<!-- Formulaire d'ajout -->
<div class="card">
    <h2>â• Enregistrer une activitÃ©</h2>
    <form method="POST" action="{{ url_for('add_activity') }}">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" class="form-control" id="date" name="date" 
                       value="{{ today.isoformat() }}" required>
            </div>
            
            <div class="form-group">
                <label for="activity_type">Type d'activitÃ©</label>
                <select class="form-control" id="activity_type" name="activity_type" required onchange="toggleFields()">
                    <option value="">-- Choisir --</option>
                    <option value="Marche">ğŸš¶ Marche</option>
                    <option value="Course">ğŸƒ Course</option>
                    <option value="VÃ©lo">ğŸš´ VÃ©lo</option>
                    <option value="Natation">ğŸŠ Natation</option>
                    <option value="Musculation">ğŸ’ª Musculation</option>
                    <option value="Yoga">ğŸ§˜ Yoga</option>
                    <option value="Pas">ğŸ‘£ Pas quotidiens</option>
                    <option value="Autre">ğŸ¯ Autre</option>
                </select>
            </div>

            <div class="form-group" id="steps_field" style="display: none;">
                <label for="steps">Nombre de pas</label>
                <input type="number" class="form-control" id="steps" name="steps" 
                       placeholder="Ex: 8500" min="0">
            </div>
            
            <div class="form-group" id="duration_field">
                <label for="duration">DurÃ©e (minutes)</label>
                <input type="number" class="form-control" id="duration" name="duration" 
                       placeholder="Ex: 30" min="0">
            </div>
            
            <div class="form-group" id="calories_field">
                <label for="calories_burned">Calories brÃ»lÃ©es (optionnel)</label>
                <input type="number" class="form-control" id="calories_burned" name="calories_burned" 
                       placeholder="Ex: 250" min="0">
            </div>
        </div>
        
        <div class="form-group" id="note_field">
            <label for="note">Note (optionnel)</label>
            <input type="text" class="form-control" id="note" name="note" 
                   placeholder="Ex: Parcours en forÃªt, bon rythme">
        </div>
        
        <button type="submit" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
    </form>
</div>

<!-- Historique -->
<div class="card">
    <h2>ğŸ“‹ Historique</h2>
    {% if entries %}
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>DÃ©tails</th>
                    <th>Note</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                <tr>
                    <td style="font-weight: 600;">
                        {{ entry.date.strftime('%d/%m/%Y') }}
                        {% if entry.date == today %}
                            <span style="background: linear-gradient(135deg, var(--primary-start), var(--primary-end)); color: white; padding: 2px 8px; border-radius: 6px; font-size: 11px; margin-left: 8px;">AUJOURD'HUI</span>
                        {% endif %}
                    </td>
                    <td>
                        <strong style="color: var(--text-primary);">
                            {% if entry.activity_type == 'Marche' %}ğŸš¶
                            {% elif entry.activity_type == 'Course' %}ğŸƒ
                            {% elif entry.activity_type == 'VÃ©lo' %}ğŸš´
                            {% elif entry.activity_type == 'Natation' %}ğŸŠ
                            {% elif entry.activity_type == 'Musculation' %}ğŸ’ª
                            {% elif entry.activity_type == 'Yoga' %}ğŸ§˜
                            {% elif entry.activity_type == 'Pas' %}ğŸ‘£
                            {% else %}ğŸ¯
                            {% endif %}
                            {{ entry.activity_type }}
                        </strong>
                    </td>
                    <td>
                        {% if entry.activity_type == 'Pas' %}
                            <strong style="color: #10b981; font-size: 18px;">{{ entry.steps or 0 }}</strong> pas
                        {% else %}
                            {% if entry.duration %}
                                <span style="color: var(--text-secondary);">â±ï¸ {{ entry.duration }} min</span>
                            {% endif %}
                            {% if entry.calories_burned %}
                                <span style="color: #ef4444; margin-left: 12px;">ğŸ”¥ {{ entry.calories_burned }} kcal</span>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if entry.note %}
                            <span style="color: #6b7280; font-size: 13px;">{{ entry.note }}</span>
                        {% else %}
                            <span style="color: #d1d5db;">â€”</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('delete_activity', id=entry.id) }}" 
                           class="btn btn-danger btn-small"
                           onclick="return confirm('Supprimer cette activitÃ© ?')">
                            ğŸ—‘ï¸ Supprimer
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.3;">ğŸƒ</div>
            <p style="color: #9ca3af; font-size: 18px; margin: 0;">Aucune activitÃ© enregistrÃ©e pour le moment</p>
            <p style="color: #d1d5db; font-size: 14px; margin-top: 8px;">Enregistre ta premiÃ¨re activitÃ© !</p>
        </div>
    {% endif %}
</div>

<!-- Statistiques -->
{% if entries %}
<div class="stats-grid">
    <div class="stat-card">
        <h3>Total activitÃ©s</h3>
        <div class="value">{{ entries|length }}</div>
        <div class="unit">jours actifs</div>
    </div>
    
    <div class="stat-card">
        <h3>Cette semaine</h3>
        <div class="value">{{ stats.week_count }}</div>
        <div class="unit">activitÃ©s</div>
    </div>
    
    {% if stats.total_steps > 0 %}
    <div class="stat-card">
        <h3>Total de pas</h3>
        <div class="value">{{ "{:,}".format(stats.total_steps).replace(',', ' ') }}</div>
        <div class="unit">pas</div>
    </div>
    {% endif %}
    
    {% if stats.total_calories > 0 %}
    <div class="stat-card">
        <h3>Calories brÃ»lÃ©es</h3>
        <div class="value">{{ "{:,}".format(stats.total_calories).replace(',', ' ') }}</div>
        <div class="unit">kcal</div>
    </div>
    {% endif %}
</div>
{% endif %}

<script>
    function toggleFields() {
        const activityType = document.getElementById('activity_type').value;
        const stepsField = document.getElementById('steps_field');
        const durationField = document.getElementById('duration_field');
        const caloriesField = document.getElementById('calories_field');
        const stepsInput = document.getElementById('steps');
        const durationInput = document.getElementById('duration');
        
        if (activityType === 'Pas') {
            // Mode "Pas quotidiens"
            stepsField.style.display = 'block';
            durationField.style.display = 'none';
            caloriesField.style.display = 'none';
            
            stepsInput.required = true;
            durationInput.required = false;
            durationInput.value = '0';
        } else if (activityType) {
            // Mode activitÃ© normale
            stepsField.style.display = 'none';
            durationField.style.display = 'block';
            caloriesField.style.display = 'block';
            
            stepsInput.required = false;
            stepsInput.value = '';
            durationInput.required = true;
        }
    }
</script>

{% endblock %}
